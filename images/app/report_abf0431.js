!function(){function e(e){document.addEventListener?document.addEventListener("DOMContentLoaded",function(){e&&e()},!1):document.attachEvent("onreadystatechange",function(){"complete"==document.readyState&&e&&e()})}function t(){var e=utils.query("#reviewList")[0];if(e){e.style.width=e.nextElementSibling.getBoundingClientRect().width+"px";var t=e.children[0];t.style.width=t.children[0].getBoundingClientRect().width*(t.children.length+.5)+"px",t.style.height=t.children[0].getBoundingClientRect().height+"px",new IScroll("#reviewList",{scrollX:!0,scrollY:!0})}}function r(e){return e=null!=e?e:{},JSON.stringify(e).replace(/"/g,"'")}function i(e){return e=null!=e?e:"{}",JSON.parse(e.replace(/'/g,'"'))}e(function(){var e,s=function(e){return e&&(e=location.search.substring(1).match(/userId=([^=]+)/),e&&e[1])?"0"==e[1]?"":e[1]:""}(location.search);if("0"==s||!s)return alert("没有学习报告");window.insertUserData=function(e){utils.query("#avatar")[0].src=e.header||"build/images/avatar_userinfo1.png",utils.query("#avatar")[0].onerror=function(){this.src="build/images/avatar_userinfo1.png"},utils.query("#nickname")[0].innerHTML=e.nickName||"用户"+(""+Math.random()).substring(2,8)},window.insertData=function(s){function a(t){for(var r="",i=0;i<e.length;i++){var s=e[i];if(s.courseId==t){r=s.courseWordList.map(function(e){return e.wordName}).join("、");break}}return r}utils.query("#correctWord")[0].innerHTML=s.totalWords,utils.query("#correctPercent")[0].innerHTML=s.percent+"%",utils.query("#correctWidth")[0].style.width=s.percent+"%",utils.query("#correctLeft")[0].style.left=Math.min(97,Math.max(3,s.percent))+"%",utils.query("#stepDetail")[0].innerHTML=s.readWordDesc,utils.query("#ccImg")[0].src="build/images/course/"+s.courseIcon+".png",utils.query("#ccTitle")[0].innerHTML=s.courseName,utils.query("#ccDetail")[0].innerHTML=s.courseDesc||"",utils.query("#ccWords")[0].innerHTML=s.courseWordList.map(function(e){e.graspFlag=""+e.graspFlag;var t="";switch(e.graspFlag){case"0":t="icon-word-state3";break;case"1":t="icon-word-state2";break;case"2":t="icon-word-state1";break;default:t="icon-word-state4"}return'<li class="'+t+'">'+e.wordName+"</li>"}).join("");var n,u=s.courseId;utils.query("#rwCourse")[0].innerHTML=s.reviewCourseList.map(function(e){var t="";switch(e.courseId==u&&(t="active ",n=e),""+e.status){case"1":t+="icon_unselected";break;case"2":t+="icon_false";break;case"3":t+="icon_checkmark";break;default:t+="icon_lokced"}return'<li class="'+t+'" data-json="'+r(e)+'">'+e.courseName+"</li>"}).join(""),utils.query("#rwImg")[0].src="build/images/"+n.reviewIcon,utils.query("#rwTitle")[0].innerHTML=n.reviewName,utils.query("#rwDetail")[0].innerHTML=n.reviewDesc.replace("{words}",a(u)),utils.query("#rwUrl")[0].title=n.reviewIe+"#wechat_redirect",utils.query("#rwUrl")[0].setAttribute("data-status",n.status),utils.query("#rwUrl")[0].setAttribute("data-courseid",n.courseId);var c=new Hammer(utils.query("#rwCourse")[0],{});c.on("tap",function(e){var t=e.target;if("LI"==t.tagName.toUpperCase()&&-1==t.className.indexOf("active")){if(-1!=t.className.indexOf("icon_lokced"))return alert("该课程未解锁");document.querySelectorAll("#rwCourse .active")[0].className=document.querySelectorAll("#rwCourse .active")[0].className.replace("active",""),t.className+=" active";var r=i(t.getAttribute("data-json"));utils.query("#rwImg")[0].src="build/images/"+r.reviewIcon,utils.query("#rwTitle")[0].innerHTML=r.reviewName,utils.query("#rwDetail")[0].innerHTML=r.reviewDesc.replace("{words}",a(r.courseId)),utils.query("#rwUrl")[0].title=r.reviewIe+"#wechat_redirect",utils.query("#rwUrl")[0].setAttribute("data-status",r.status),utils.query("#rwUrl")[0].setAttribute("data-courseid",r.courseId)}}),t()},utils.jsonp({url:"http://api.tinman.cn/jojosherlock/v1/user/getUserCourseReport",data:{userId:s},success:function(t){200==t.status?(e=t.data.courseList,utils.jsonp({url:"http://api.tinman.cn/jojosherlock/v1/user/getUserReport",data:{userId:s},success:function(e){200==e.status?window.insertData(e.data):alert(e.info||"服务器错误,请稍后再试")},error:function(){alert("error")}})):alert(t.info||"服务器错误,请稍后再试")}}),utils.jsonp({url:"http://api.tinman.cn/jojosherlock/v1/user/getUserInfo",data:{userId:s},success:function(e){200==e.status?window.insertUserData(e.data):alert(e.info||"服务器错误,请稍后再试")},error:function(){alert("error")}});var a=new Hammer(utils.query("#wrapper")[0],{}),n=utils.query("#currentTips")[0];a.on("tap",function(e){{var t=e.target,r=t.getAttribute("data-handle");i(t.getAttribute("data-json"))}if(!r)return void(-1!=n.className.indexOf("active")&&(n.style.display="none",n.className="current-tips"));if("showTips"==r)return-1!=n.className.indexOf("active")?(n.style.display="none",n.className="current-tips"):(n.style.display="block",n.className+=" active"),"";if("changeStatus"==r){if("0"==t.getAttribute("data-status"))return alert("您还没有学习该课程");utils.ajax({url:"http://api.tinman.cn/jojosherlock/v1/user/setUserReviewCourse",type:"post",data:{json:JSON.stringify([{courseId:t.getAttribute("data-courseid"),studyTime:parseInt((new Date).getTime()/1e3)}])},success:function(){location.href=t.title},error:function(){location.href=t.title}})}else-1!=n.className.indexOf("active")&&(n.style.display="none",n.className="current-tips")}),document.body.style.visibility="visible"}),window.addEventListener("onorientationchange"in window?"orientationchange":"resize",function(){setTimeout(t,500)})}();