!function(){function e(e){stat({siteId:7,userId:m,moduleName:"微信邀请送课程",objectName:"click_wechat_free","package":"wechat"}),t({url:a+"user/setUserInvite",type:"post",data:{userId:m,phone:e},success:function(t){200==t.status?(window.scrollTo(0,0),d.innerHTML=e,location.replace(location.href+"#"+e),o.style.display="none",s.style.display="block",r.blur()):u.innerHTML=f[t.status]||"领取失败"},error:function(e){u.innerHTML=e.info}})}function t(e){function t(e){var t=[];for(var n in e)t.push(n+"="+e[n]);return t.join("&")}e=e||{},e.type=(e.type||"GET").toUpperCase(),e.data=e.data||{},e.header=e.header||{};var n=null;n=window.XMLHttpRequest?new XMLHttpRequest:new ActiveXObject("Microsoft.XMLHTTP"),"POST"==e.type?(n.open(e.type,e.url,!0),n.setRequestHeader("Content-type","application/x-www-form-urlencoded"),e.data=t(e.data)):"GET"==e.type&&(e.url+="?"+t(e.data),n.open(e.type,e.url,!0),e.data=null);for(var a in e.header)n.setRequestHeader(a,e.header[a]);n.onreadystatechange=function(){4==n.readyState&&200==n.status&&(/^\{(?:.*)\}$/.test(n.responseText)?e.success&&e.success.call(n,JSON.parse(n.responseText)):e.success&&e.success.call(n,n.responseText))},n.send(e.data)}function n(e){if(location.search){var t=new RegExp(e+"=([^&$]+)"),n=location.search.match(t);return n&&n[1]?n[1]:null}return null}var a="http://api.tinman.cn/jojosherlock/v1/",c=/^0?(13|14|15|17|18)[0-9]{9}$/,s=document.getElementById("got"),o=document.getElementById("acceptInvitation"),i=document.getElementById("getCourse"),r=document.getElementById("phone"),u=document.getElementById("error"),d=document.getElementById("phoneText"),l=document.getElementById("avatar"),p=document.getElementById("download"),m=n("userId");if(!m)return alert("页面缺少必要参数");stat({siteId:7,userId:m,moduleName:"微信邀请送课程",objectName:"wechat_share_open","package":"wechat"});var h,f={40100:"您的手机号已注册<br>邀请功能只对新用户有效",50501:"该手机号码已经领取"};return document.body.addEventListener("click",function(e){h&&(h=null,clearTimeout(h)),e.target!=r&&(h=setTimeout(function(){},300))}),l.onerror=function(){this.src="./build/images/avatar_ph.png?__inline",this.className=""},t({url:a+"wechat/getWechatUserInfo",data:{userId:m},success:function(e){if(200==e.status){e.data=e.data||{};var n=e.data.nickname||"";n&&(document.getElementById("nickname").innerHTML=n),e.data.headimgurl&&(l.src=e.data.headimgurl,l.className="header"),t({url:"http://api.tinman.cn/jojosherlock/v1/wechat/getJsapiConfig",data:{userId:m,url:encodeURIComponent(location.href)},success:function(e){if(200!=e.status)return alert(e.info);var t=e.data;wx.config({debug:!1,appId:t.appId,timestamp:t.timestamp,nonceStr:t.nonceStr,signature:t.signature,jsApiList:["onMenuShareTimeline","onMenuShareAppMessage"]}),wx.ready(function(){wx.onMenuShareAppMessage({title:"接受"+(n||"小伙伴")+"的邀请，体验最有趣的识字课程",desc:"孩子在快乐游戏中学汉字\n学习+复习，识字有效率\n每天10分钟，自信上小学\n全球超过3000万用户",link:"http://api.tinman.cn/jojosherlock/web/accept-invitation.html"+location.search,imgUrl:"http://web.tinman.cn/static/jojosherlock_cdn/other/icon_wx2.png",type:"link",dataUrl:"",success:function(){stat({siteId:7,userId:m,moduleName:"微信邀请送课程",objectName:"scan_code_sharesuccess","package":"wechat"})},cancel:function(){}}),wx.onMenuShareTimeline({title:"你家崽崽该识字了吗？帮我点一点，都有免费课程赠送哦！|  还不点点点点",link:"http://api.tinman.cn/jojosherlock/web/accept-invitation.html"+location.search,imgUrl:"http://web.tinman.cn/static/jojosherlock_cdn/other/icon_wx2.png",success:function(){stat({siteId:7,userId:m,moduleName:"微信邀请送课程",objectName:"scan_code_sharesuccess","package":"wechat"})},cancel:function(){}})}),wx.error(function(){})}})}}}),c.test(location.hash.substring(1))?(s.style.display="block",o.style.display="none",d.innerHTML=location.hash.substring(1),void p.addEventListener("click",function(){return stat({siteId:7,userId:m,moduleName:"微信邀请送课程",objectName:"click_wechat_down","package":"wechat"}),!0})):(o.style.display="block",r.addEventListener("keyup",function(t){var n=r.value;i.className=c.test(n)?"btn btn-green":"btn btn-disable",13==t.keyCode?c.test(n)?e(n):(r.focus(),u.innerHTML="你输入的手机格式不正确"):u.innerHTML="&nbsp;"}),i.addEventListener("click",function(){if(-1!=this.className.indexOf("btn-disable"))return!1;var t=r.value;c.test(t)?e(t):(r.focus(),u.innerHTML="你输入的手机格式不正确")}),void p.addEventListener("click",function(){return stat({siteId:7,userId:m,moduleName:"微信邀请送课程",objectName:"click_wechat_down","package":"wechat"}),!0}))}();